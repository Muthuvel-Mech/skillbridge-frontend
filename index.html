<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="UTF-8">
  <title>SkillBridge AI</title>
</head>
<body>
  <h2>SkillBridge AI</h2>
  <textarea id="userInput" placeholder="உங்க skills அல்லது career interest எழுதுங்க"></textarea>
  <br><br>
  <button onclick="getRecommendation()">Career Advice வாங்க</button>
  <button onclick="saveResult()">💾 Save</button>
  <button onclick="getHistory()">📜 History</button>
  <button onclick="exportPDF()">⬇️ PDF Export</button>

  <h3>Result:</h3>
  <pre id="result"></pre>

  <script>
    const API_BASE = "https://skillbridge-backend-5.onrender.com";

    async function getRecommendation() {
      const input = document.getElementById("userInput").value.trim();
      if (!input) {
        document.getElementById("result").textContent = "❌ Input கொடுக்கல.";
        return;
      }

      const res = await fetch(`${API_BASE}/api/recommend`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ skills: input })
      });

      const data = await res.json();
      console.log("API Response:", data); // Debug பார்க்க

      // backend என்ன தருதோ அதையே காட்டும்
      document.getElementById("result").textContent =
        data.recommendation || data.message || data.error || "⚠️ Result இல்லை";
    }

    async function saveResult() {
      const content = document.getElementById("result").textContent;
      if (!content) {
        alert("Save செய்ய result இல்லை!");
        return;
      }
      const res = await fetch(`${API_BASE}/api/save`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content })
      });
      const data = await res.json();
      alert("✅ Saved! Doc ID: " + (data.doc_id || "error"));
    }

    async function getHistory() {
      const res = await fetch(`${API_BASE}/api/history`);
      const data = await res.json();
      document.getElementById("result").textContent = JSON.stringify(data, null, 2);
    }

    async function exportPDF() {
      const content = document.getElementById("result").textContent;
      if (!content) {
        alert("PDF export செய்ய result இல்லை!");
        return;
      }
      const res = await fetch(`${API_BASE}/api/export_pdf`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content })
      });
      if (res.ok) {
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "SkillBridge_Report.pdf";
        a.click();
        window.URL.revokeObjectURL(url);
      } else {
        alert("❌ PDF Export fail ஆயிடுச்சு");
      }
    }
  </script>
</body>
</html>
