<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="UTF-8">
  <title>SkillBridge AI</title>
</head>
<body>
  <h2>SkillBridge AI</h2>
  <textarea id="userInput" placeholder="à®‰à®™à¯à®• skills à®…à®²à¯à®²à®¤à¯ career interest à®à®´à¯à®¤à¯à®™à¯à®•"></textarea>
  <br><br>
  <button onclick="getRecommendation()">Career Advice à®µà®¾à®™à¯à®•</button>
  <button onclick="saveResult()">ğŸ’¾ Save</button>
  <button onclick="getHistory()">ğŸ“œ History</button>
  <button onclick="exportPDF()">â¬‡ï¸ PDF Export</button>

  <h3>Result:</h3>
  <pre id="result"></pre>

  <script>
    const API_BASE = "https://skillbridge-backend-5.onrender.com";

    async function getRecommendation() {
      const input = document.getElementById("userInput").value.trim();
      if (!input) {
        document.getElementById("result").textContent = "âŒ Input à®•à¯Šà®Ÿà¯à®•à¯à®•à®².";
        return;
      }

      const res = await fetch(`${API_BASE}/api/recommend`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ skills: input })
      });

      const data = await res.json();
      console.log("API Response:", data); // Debug à®ªà®¾à®°à¯à®•à¯à®•

      // backend à®à®©à¯à®© à®¤à®°à¯à®¤à¯‹ à®…à®¤à¯ˆà®¯à¯‡ à®•à®¾à®Ÿà¯à®Ÿà¯à®®à¯
      document.getElementById("result").textContent =
        data.recommendation || data.message || data.error || "âš ï¸ Result à®‡à®²à¯à®²à¯ˆ";
    }

    async function saveResult() {
      const content = document.getElementById("result").textContent;
      if (!content) {
        alert("Save à®šà¯†à®¯à¯à®¯ result à®‡à®²à¯à®²à¯ˆ!");
        return;
      }
      const res = await fetch(`${API_BASE}/api/save`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content })
      });
      const data = await res.json();
      alert("âœ… Saved! Doc ID: " + (data.doc_id || "error"));
    }

    async function getHistory() {
      const res = await fetch(`${API_BASE}/api/history`);
      const data = await res.json();
      document.getElementById("result").textContent = JSON.stringify(data, null, 2);
    }

    async function exportPDF() {
      const content = document.getElementById("result").textContent;
      if (!content) {
        alert("PDF export à®šà¯†à®¯à¯à®¯ result à®‡à®²à¯à®²à¯ˆ!");
        return;
      }
      const res = await fetch(`${API_BASE}/api/export_pdf`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content })
      });
      if (res.ok) {
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "SkillBridge_Report.pdf";
        a.click();
        window.URL.revokeObjectURL(url);
      } else {
        alert("âŒ PDF Export fail à®†à®¯à®¿à®Ÿà¯à®šà¯à®šà¯");
      }
    }
  </script>
</body>
</html>
