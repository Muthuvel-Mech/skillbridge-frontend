<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SkillBridge AI</title>
</head>
<body>
  <h2>SkillBridge AI</h2>
  <textarea id="userInput" placeholder="Enter your skills or career interest"></textarea>
  <br><br>
  <button onclick="getRecommendation()">Get Career Advice</button>
  <button onclick="saveResult()">💾 Save</button>
  <button onclick="getHistory()">📜 History</button>
  <button onclick="exportPDF()">⬇️ Export PDF</button>

  <h3>Result:</h3>
  <pre id="result"></pre>

  <script>
    const API_BASE = "https://skillbridge-backend-5.onrender.com";

    // ✅ FIXED version
    async function getRecommendation() {
      const input = document.getElementById("userInput").value;
      const res = await fetch(`${API_BASE}/api/recommend`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ skills: input })  // <-- FIXED (was input before)
      });
      const data = await res.json();
      document.getElementById("result").textContent = data.recommendation || data.error;
    }

    async function saveResult() {
      const content = document.getElementById("result").textContent;
      if (!content) {
        alert("No result to save!");
        return;
      }
      const res = await fetch(`${API_BASE}/api/save`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content })
      });
      const data = await res.json();
      alert("Saved ✅ Doc ID: " + (data.doc_id || "error"));
    }

    async function getHistory() {
      const res = await fetch(`${API_BASE}/api/history`);
      const data = await res.json();
      document.getElementById("result").textContent = JSON.stringify(data, null, 2);
    }

    async function exportPDF() {
      const content = document.getElementById("result").textContent;
      if (!content) {
        alert("No result to export!");
        return;
      }
      const res = await fetch(`${API_BASE}/api/export_pdf`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content })
      });
      if (res.ok) {
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "SkillBridge_Report.pdf";
        a.click();
        window.URL.revokeObjectURL(url);
      } else {
        alert("❌ Failed to export PDF");
      }
    }
  </script>
</body>
</html>
